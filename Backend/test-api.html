<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360 Feedback API Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .api-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .api-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .response {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .response.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .response.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .endpoint-info {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 14px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>360 Feedback API Tester</h1>
        
        <!-- Authentication Section -->
        <div class="api-section">
            <h3>üîê Authentication</h3>
            <div class="endpoint-info">
                POST /api/auth - Login, Logout, Register
            </div>
            
            <div class="form-group">
                <label>Action:</label>
                <select id="authAction">
                    <option value="login">Login</option>
                    <option value="logout">Logout</option>
                    <option value="register">Register</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Employee ID:</label>
                <input type="text" id="authEmpId" placeholder="E001">
            </div>
            
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="authPassword" placeholder="password123">
            </div>
            
            <div class="form-group">
                <label>First Name (for register):</label>
                <input type="text" id="authFname" placeholder="John">
            </div>
            
            <div class="form-group">
                <label>Last Name (for register):</label>
                <input type="text" id="authLname" placeholder="Doe">
            </div>
            
            <button onclick="testAuth()">Test Authentication</button>
            <div id="authResponse" class="response"></div>
        </div>

        <div class="grid">
            <!-- Users Section -->
            <div class="api-section">
                <h3>üë• Users</h3>
                <div class="endpoint-info">
                    GET /api/users<br>
                    POST /api/users
                </div>
                
                <div class="form-group">
                    <label>Rounded:</label>
                    <input type="text" id="usersRounded" value="5">
                </div>
                
                <button onclick="getUsers()">Get Users</button>
                <button onclick="testUserCreate()">Create User</button>
                <div id="usersResponse" class="response"></div>
            </div>

            <!-- Surveys Section -->
            <div class="api-section">
                <h3>üìã Surveys</h3>
                <div class="endpoint-info">
                    GET /api/surveys<br>
                    POST /api/surveys
                </div>
                
                <div class="form-group">
                    <label>Rounded:</label>
                    <input type="text" id="surveysRounded" value="5">
                </div>
                
                <button onclick="getSurveys()">Get Surveys</button>
                <button onclick="testSurveyCreate()">Create Survey</button>
                <div id="surveysResponse" class="response"></div>
            </div>

            <!-- Questions Section -->
            <div class="api-section">
                <h3>‚ùì Questions</h3>
                <div class="endpoint-info">
                    GET /api/questions<br>
                    POST /api/questions
                </div>
                
                <div class="form-group">
                    <label>Subject ID:</label>
                    <input type="text" id="questionsSubId" placeholder="1">
                </div>
                
                <button onclick="getQuestions()">Get Questions</button>
                <button onclick="testQuestionCreate()">Create Question</button>
                <div id="questionsResponse" class="response"></div>
            </div>

            <!-- Employees Section -->
            <div class="api-section">
                <h3>üë®‚Äçüíº Employees</h3>
                <div class="endpoint-info">
                    GET /api/employees<br>
                    POST /api/employees
                </div>
                
                <div class="form-group">
                    <label>Rounded:</label>
                    <input type="text" id="employeesRounded" value="5">
                </div>
                
                <div class="form-group">
                    <label>Search:</label>
                    <input type="text" id="employeesSearch" placeholder="Search keyword">
                </div>
                
                <button onclick="getEmployees()">Get Employees</button>
                <button onclick="testEmployeeCreate()">Create Employee</button>
                <div id="employeesResponse" class="response"></div>
            </div>
        </div>

        <!-- Survey Answers Section -->
        <div class="api-section">
            <h3>üìù Survey Answers</h3>
            <div class="endpoint-info">
                GET /api/survey-answers<br>
                POST /api/survey-answers
            </div>
            
            <div class="form-group">
                <label>Employee ID:</label>
                <input type="text" id="answersEmpId" placeholder="E001">
            </div>
            
            <div class="form-group">
                <label>Rounded:</label>
                <input type="text" id="answersRounded" value="5">
            </div>
            
            <div class="form-group">
                <label>Subject ID:</label>
                <input type="text" id="answersSubId" placeholder="1">
            </div>
            
            <button onclick="getSurveyAnswers()">Get Answers</button>
            <button onclick="testAnswerSave()">Save Answer</button>
            <div id="answersResponse" class="response"></div>
        </div>

        <!-- Reports Section -->
        <div class="api-section">
            <h3>üìä Reports</h3>
            <div class="endpoint-info">
                GET /api/reports<br>
                POST /api/reports
            </div>
            
            <div class="form-group">
                <label>Report Type:</label>
                <select id="reportType">
                    <option value="summary">Summary</option>
                    <option value="user">User</option>
                    <option value="subject">Subject</option>
                    <option value="group">Group</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Rounded:</label>
                <input type="text" id="reportRounded" value="5">
            </div>
            
            <div class="form-group">
                <label>Employee ID (for user report):</label>
                <input type="text" id="reportEmpId" placeholder="E001">
            </div>
            
            <button onclick="getReports()">Get Reports</button>
            <div id="reportsResponse" class="response"></div>
        </div>

        <!-- Admin Section -->
        <div class="api-section">
            <h3>‚öôÔ∏è Admin</h3>
            <div class="endpoint-info">
                GET /api/admin<br>
                POST /api/admin
            </div>
            
            <div class="form-group">
                <label>Action:</label>
                <select id="adminAction">
                    <option value="dashboard">Dashboard</option>
                    <option value="users">Users</option>
                    <option value="statistics">Statistics</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Rounded:</label>
                <input type="text" id="adminRounded" value="5">
            </div>
            
            <button onclick="getAdminData()">Get Admin Data</button>
            <div id="adminResponse" class="response"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/360/api';
        
        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `response ${isError ? 'error' : 'success'}`;
        }

        function showError(elementId, error) {
            const element = document.getElementById(elementId);
            element.textContent = `Error: ${error}`;
            element.className = 'response error';
        }

        // Authentication
        async function testAuth() {
            const action = document.getElementById('authAction').value;
            const empId = document.getElementById('authEmpId').value;
            const password = document.getElementById('authPassword').value;
            const fname = document.getElementById('authFname').value;
            const lname = document.getElementById('authLname').value;

            const data = { action, emp_id: empId, password };
            if (action === 'register') {
                data.emp_fname = fname;
                data.emp_lname = lname;
            }

            try {
                const response = await fetch(`${API_BASE}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('authResponse', result, !result.success);
            } catch (error) {
                showError('authResponse', error.message);
            }
        }

        // Users
        async function getUsers() {
            const rounded = document.getElementById('usersRounded').value;
            try {
                const response = await fetch(`${API_BASE}/users?rounded=${rounded}`);
                const result = await response.json();
                showResponse('usersResponse', result, !result.success);
            } catch (error) {
                showError('usersResponse', error.message);
            }
        }

        async function testUserCreate() {
            const data = {
                action: 'create',
                emp_id: 'TEST001',
                rounded: '5',
                emp_fname: 'Test',
                emp_lname: 'User',
                emp_nickname: 'Test',
                emp_div: 'IT',
                emp_dep: 'Development',
                emp_position: 'Developer',
                emp_level: 'Senior'
            };

            try {
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('usersResponse', result, !result.success);
            } catch (error) {
                showError('usersResponse', error.message);
            }
        }

        // Surveys
        async function getSurveys() {
            const rounded = document.getElementById('surveysRounded').value;
            try {
                const response = await fetch(`${API_BASE}/surveys?rounded=${rounded}`);
                const result = await response.json();
                showResponse('surveysResponse', result, !result.success);
            } catch (error) {
                showError('surveysResponse', error.message);
            }
        }

        async function testSurveyCreate() {
            const data = {
                action: 'save',
                sub_title: 'Test Survey',
                sub_title_m: '‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                sub_discrip: 'Test Description',
                sub_discrip_m: '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                sub_band: '5',
                type_group: '1',
                sub_status: '1'
            };

            try {
                const response = await fetch(`${API_BASE}/surveys`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('surveysResponse', result, !result.success);
            } catch (error) {
                showError('surveysResponse', error.message);
            }
        }

        // Questions
        async function getQuestions() {
            const subId = document.getElementById('questionsSubId').value;
            const url = subId ? `${API_BASE}/questions?sub_id=${subId}` : `${API_BASE}/questions`;
            try {
                const response = await fetch(url);
                const result = await response.json();
                showResponse('questionsResponse', result, !result.success);
            } catch (error) {
                showError('questionsResponse', error.message);
            }
        }

        async function testQuestionCreate() {
            const data = {
                action: 'save',
                sub_id: '1',
                q_title: 'Test Question',
                q_title_m: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                q_type: 'rating',
                q_status: '1'
            };

            try {
                const response = await fetch(`${API_BASE}/questions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('questionsResponse', result, !result.success);
            } catch (error) {
                showError('questionsResponse', error.message);
            }
        }

        // Employees
        async function getEmployees() {
            const rounded = document.getElementById('employeesRounded').value;
            const search = document.getElementById('employeesSearch').value;
            let url = `${API_BASE}/employees?rounded=${rounded}`;
            if (search) url += `&search=${search}`;
            
            try {
                const response = await fetch(url);
                const result = await response.json();
                showResponse('employeesResponse', result, !result.success);
            } catch (error) {
                showError('employeesResponse', error.message);
            }
        }

        async function testEmployeeCreate() {
            const data = {
                action: 'save',
                rounded: '5',
                emp_fname: 'Test',
                emp_lname: 'Employee',
                emp_nickname: 'TestEmp',
                emp_div: 'IT',
                emp_dep: 'Development',
                emp_position: 'Developer',
                emp_level: 'Senior'
            };

            try {
                const response = await fetch(`${API_BASE}/employees`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('employeesResponse', result, !result.success);
            } catch (error) {
                showError('employeesResponse', error.message);
            }
        }

        // Survey Answers
        async function getSurveyAnswers() {
            const empId = document.getElementById('answersEmpId').value;
            const rounded = document.getElementById('answersRounded').value;
            const subId = document.getElementById('answersSubId').value;
            
            let url = `${API_BASE}/survey-answers?rounded=${rounded}`;
            if (empId) url += `&emp_id=${empId}`;
            if (subId) url += `&sub_id=${subId}`;
            
            try {
                const response = await fetch(url);
                const result = await response.json();
                showResponse('answersResponse', result, !result.success);
            } catch (error) {
                showError('answersResponse', error.message);
            }
        }

        async function testAnswerSave() {
            const data = {
                action: 'save',
                emp_id: 'E001',
                q_id: '1',
                answer_score: '4',
                answer_comment: 'Good',
                rounded: '5'
            };

            try {
                const response = await fetch(`${API_BASE}/survey-answers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('answersResponse', result, !result.success);
            } catch (error) {
                showError('answersResponse', error.message);
            }
        }

        // Reports
        async function getReports() {
            const type = document.getElementById('reportType').value;
            const rounded = document.getElementById('reportRounded').value;
            const empId = document.getElementById('reportEmpId').value;
            
            let url = `${API_BASE}/reports?type=${type}&rounded=${rounded}`;
            if (empId && type === 'user') url += `&emp_id=${empId}`;
            
            try {
                const response = await fetch(url);
                const result = await response.json();
                showResponse('reportsResponse', result, !result.success);
            } catch (error) {
                showError('reportsResponse', error.message);
            }
        }

        // Admin
        async function getAdminData() {
            const action = document.getElementById('adminAction').value;
            const rounded = document.getElementById('adminRounded').value;
            
            try {
                const response = await fetch(`${API_BASE}/admin?action=${action}&rounded=${rounded}`);
                const result = await response.json();
                showResponse('adminResponse', result, !result.success);
            } catch (error) {
                showError('adminResponse', error.message);
            }
        }
    </script>
</body>
</html>
